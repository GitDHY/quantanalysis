{
    "è¶‹åŠ¿è·Ÿè¸ª1": {
        "name": "è¶‹åŠ¿è·Ÿè¸ª1",
        "code": "\"\"\"\nè¶‹åŠ¿è·Ÿè¸ªç­–ç•¥ (Trend Following)\nåªæŒæœ‰å¤„äºä¸Šå‡è¶‹åŠ¿çš„èµ„äº§ï¼ˆä»·æ ¼åœ¨å‡çº¿ä¸Šæ–¹ï¼‰ã€‚\n\"\"\"\n\ndef strategy():\n    weights = ctx.get_current_weights()\n    \n    # ç­–ç•¥å‚æ•°\n    ma_period = 200     # é•¿æœŸå‡çº¿\n    trend_ma = 50       # è¶‹åŠ¿ç¡®è®¤å‡çº¿\n    \n    total_weight = 100\n    trending_assets = []\n    \n    # è¯†åˆ«è¶‹åŠ¿èµ„äº§\n    for ticker in ctx.tickers:\n        if ctx.price_above_ma(ticker, ma_period):\n            trending_assets.append(ticker)\n    \n    ctx.log(f\"ğŸ“Š è¶‹åŠ¿å‘ä¸Šçš„èµ„äº§: {trending_assets}\")\n    \n    if not trending_assets:\n        # æ²¡æœ‰è¶‹åŠ¿èµ„äº§ï¼Œä¿å®ˆé…ç½®\n        ctx.log(\"âš ï¸ æ— è¶‹åŠ¿èµ„äº§ï¼Œä¿æŒç°æœ‰é…ç½®\")\n        return\n    \n    # å¹³å‡åˆ†é…æƒé‡ç»™è¶‹åŠ¿èµ„äº§\n    weight_per_asset = total_weight / len(trending_assets)\n    \n    for ticker in ctx.tickers:\n        if ticker in trending_assets:\n            # è¶‹åŠ¿èµ„äº§: åˆ†é…æƒé‡\n            old_weight = weights.get(ticker, 0)\n            weights[ticker] = weight_per_asset\n            if weights[ticker] > old_weight:\n                ctx.log(f\"ğŸŸ¢ {ticker} è¶‹åŠ¿å‘ä¸Šï¼Œå¢ä»“è‡³ {weight_per_asset:.1f}%\")\n        else:\n            # éè¶‹åŠ¿èµ„äº§: æ¸…ä»“\n            if weights.get(ticker, 0) > 0:\n                ctx.log(f\"ğŸ”´ {ticker} è¶‹åŠ¿è½¬å¼±ï¼Œæ¸…ä»“\")\n            weights[ticker] = 0\n    \n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "Current",
        "created_at": "2026-02-06T17:05:25.837587",
        "updated_at": "2026-02-06T17:05:25.837592"
    },
    "é£é™©å¹³ä»·1": {
        "name": "é£é™©å¹³ä»·1",
        "code": "\"\"\"\né£é™©å¹³ä»·ç­–ç•¥ (Simplified Risk Parity)\næ ¹æ®æ³¢åŠ¨ç‡åæ¯”è°ƒæ•´ä»“ä½ï¼Œä½æ³¢åŠ¨èµ„äº§é…ç½®æ›´å¤šã€‚\n\"\"\"\n\ndef strategy():\n    weights = ctx.get_current_weights()\n    \n    # ç­–ç•¥å‚æ•°\n    vol_period = 20     # æ³¢åŠ¨ç‡è®¡ç®—å‘¨æœŸ\n    target_vol = 0.15   # ç›®æ ‡æ³¢åŠ¨ç‡ 15%\n    \n    volatilities = {}\n    \n    # è®¡ç®—å„èµ„äº§æ³¢åŠ¨ç‡\n    for ticker in ctx.tickers:\n        vol = ctx.volatility(ticker, vol_period, annualize=True)\n        if not vol.empty and vol.iloc[-1] > 0:\n            volatilities[ticker] = vol.iloc[-1]\n    \n    if not volatilities:\n        ctx.log(\"âš ï¸ æ— æ³•è®¡ç®—æ³¢åŠ¨ç‡\")\n        return\n    \n    # è®¡ç®—åæ³¢åŠ¨ç‡æƒé‡\n    inv_vol = {t: 1/v for t, v in volatilities.items()}\n    total_inv_vol = sum(inv_vol.values())\n    \n    # å½’ä¸€åŒ–æƒé‡\n    for ticker in ctx.tickers:\n        if ticker in inv_vol:\n            weights[ticker] = (inv_vol[ticker] / total_inv_vol) * 100\n            ctx.log(f\"ğŸ“Š {ticker}: æ³¢åŠ¨ç‡={volatilities[ticker]:.1%}, æƒé‡={weights[ticker]:.1f}%\")\n        else:\n            weights[ticker] = 0\n    \n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "Current",
        "created_at": "2026-02-06T17:12:22.365761",
        "updated_at": "2026-02-06T17:12:22.365786"
    },
    "RSIå‡å€¼å›å½’1": {
        "name": "RSIå‡å€¼å›å½’1",
        "code": "\"\"\"\nRSI å‡å€¼å›å½’ç­–ç•¥ (Mean Reversion)\nRSI è¶…ä¹°/è¶…å–æ—¶åå‘æ“ä½œã€‚\n\"\"\"\n\ndef strategy():\n    weights = ctx.get_current_weights()\n    \n    # ç­–ç•¥å‚æ•°\n    rsi_period = 14\n    oversold = 30       # è¶…å–é˜ˆå€¼\n    overbought = 70     # è¶…ä¹°é˜ˆå€¼\n    \n    for ticker in ctx.tickers:\n        current_weight = weights.get(ticker, 0)\n        \n        # è®¡ç®— RSI\n        rsi = ctx.rsi(ticker, rsi_period)\n        if rsi.empty:\n            continue\n        \n        current_rsi = rsi.iloc[-1]\n        \n        # è¶…å–: ä¹°å…¥ä¿¡å·\n        if current_rsi < oversold:\n            weights[ticker] = min(current_weight + 10, 50)\n            ctx.log(f\"ğŸŸ¢ {ticker} RSI={current_rsi:.0f} è¶…å–ï¼Œå¢ä»“\")\n        \n        # è¶…ä¹°: å–å‡ºä¿¡å·\n        elif current_rsi > overbought:\n            weights[ticker] = max(current_weight - 10, 5)\n            ctx.log(f\"ğŸ”´ {ticker} RSI={current_rsi:.0f} è¶…ä¹°ï¼Œå‡ä»“\")\n    \n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "Current",
        "created_at": "2026-02-06T17:13:16.257854",
        "updated_at": "2026-02-06T17:13:16.257859"
    },
    "åŠ¨é‡ç­–ç•¥1": {
        "name": "åŠ¨é‡ç­–ç•¥1",
        "code": "\"\"\"\nåŠ¨é‡ç­–ç•¥ (Momentum Strategy)\næ ¹æ®è¿‡å»ä¸€æ®µæ—¶é—´çš„æ¶¨å¹…è°ƒæ•´ä»“ä½ï¼Œè¿½æ¶¨æ€è·Œã€‚\n\"\"\"\n\ndef strategy():\n    weights = ctx.get_current_weights()\n    \n    # ç­–ç•¥å‚æ•°\n    lookback = 20       # åŠ¨é‡è®¡ç®—å‘¨æœŸ\n    threshold = 5       # åŠ¨é‡é˜ˆå€¼ (%)\n    \n    for ticker in ctx.tickers:\n        current_weight = weights.get(ticker, 0)\n        \n        # è®¡ç®—åŠ¨é‡\n        mom = ctx.momentum(ticker, lookback)\n        if mom.empty:\n            continue\n        \n        current_momentum = mom.iloc[-1]\n        \n        # æ­£å‘åŠ¨é‡: å¢åŠ ä»“ä½\n        if current_momentum > threshold:\n            weights[ticker] = min(current_weight + 5, 40)\n            ctx.log(f\"ğŸ“ˆ {ticker} åŠ¨é‡ {current_momentum:.1f}% > {threshold}%, å¢ä»“\")\n        \n        # è´Ÿå‘åŠ¨é‡: å‡å°‘ä»“ä½\n        elif current_momentum < -threshold:\n            weights[ticker] = max(current_weight - 5, 0)\n            ctx.log(f\"ğŸ“‰ {ticker} åŠ¨é‡ {current_momentum:.1f}% < -{threshold}%, å‡ä»“\")\n    \n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "Current",
        "created_at": "2026-02-06T17:14:38.891411",
        "updated_at": "2026-02-06T17:14:38.891416"
    },
    "VIXæ³¢åŠ¨ç‡1": {
        "name": "VIXæ³¢åŠ¨ç‡1",
        "code": "\"\"\"\nVIX æ³¢åŠ¨ç‡ç­–ç•¥ (Volatility Strategy)\næ ¹æ® VIX æŒ‡æ•°è°ƒæ•´é£é™©èµ„äº§ä»“ä½ã€‚\n\"\"\"\n\ndef strategy():\n    weights = ctx.get_current_weights()\n    \n    # ç­–ç•¥å‚æ•°\n    vix_low = 15        # ä½æ³¢åŠ¨é˜ˆå€¼\n    vix_high = 25       # é«˜æ³¢åŠ¨é˜ˆå€¼\n    vix_panic = 35      # ææ…Œé˜ˆå€¼\n    \n    # è·å–å½“å‰ VIX\n    current_vix = ctx.current_vix()\n    ctx.log(f\"ğŸ“Š å½“å‰ VIX: {current_vix:.1f}\")\n    \n    # å®šä¹‰é£é™©èµ„äº§å’Œé¿é™©èµ„äº§\n    risk_assets = ['IWY', 'LVHI', 'G3B.SI']  # æ ¹æ®ä½ çš„ç»„åˆè°ƒæ•´\n    safe_assets = ['GSD.SI', 'MBH.SI']       # é»„é‡‘ã€å€ºåˆ¸ç­‰\n    \n    if current_vix < vix_low:\n        # ä½æ³¢åŠ¨: æ¿€è¿›é…ç½®\n        ctx.log(\"ğŸš€ ä½æ³¢åŠ¨ç¯å¢ƒï¼Œå¢åŠ é£é™©èµ„äº§\")\n        for ticker in risk_assets:\n            if ticker in weights:\n                weights[ticker] = weights.get(ticker, 0) * 1.2\n        for ticker in safe_assets:\n            if ticker in weights:\n                weights[ticker] = weights.get(ticker, 0) * 0.8\n    \n    elif current_vix > vix_panic:\n        # ææ…Œ: é¿é™©é…ç½®\n        ctx.log(\"ğŸ›¡ï¸ ææ…Œç¯å¢ƒï¼Œå¤§å¹…å‡å°‘é£é™©èµ„äº§\")\n        for ticker in risk_assets:\n            if ticker in weights:\n                weights[ticker] = weights.get(ticker, 0) * 0.5\n        for ticker in safe_assets:\n            if ticker in weights:\n                weights[ticker] = weights.get(ticker, 0) * 1.5\n    \n    elif current_vix > vix_high:\n        # é«˜æ³¢åŠ¨: è°¨æ…é…ç½®\n        ctx.log(\"âš ï¸ é«˜æ³¢åŠ¨ç¯å¢ƒï¼Œé€‚åº¦å‡å°‘é£é™©èµ„äº§\")\n        for ticker in risk_assets:\n            if ticker in weights:\n                weights[ticker] = weights.get(ticker, 0) * 0.85\n    \n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "Current",
        "created_at": "2026-02-06T17:15:37.643974",
        "updated_at": "2026-02-06T17:15:37.643978"
    },
    "å‡çº¿äº¤å‰1": {
        "name": "å‡çº¿äº¤å‰1",
        "code": "\"\"\"\nå‡çº¿äº¤å‰ç­–ç•¥ (Moving Average Crossover)\nå½“çŸ­æœŸå‡çº¿ä¸Šç©¿é•¿æœŸå‡çº¿æ—¶å¢åŠ ä»“ä½ï¼Œä¸‹ç©¿æ—¶å‡å°‘ä»“ä½ã€‚\n\"\"\"\n\ndef strategy():\n    # è·å–å½“å‰æƒé‡\n    weights = ctx.get_current_weights()\n    \n    # ç­–ç•¥å‚æ•°\n    short_period = 20   # çŸ­æœŸå‡çº¿å‘¨æœŸ\n    long_period = 50    # é•¿æœŸå‡çº¿å‘¨æœŸ\n    \n    # éå†æ‰€æœ‰æ ‡çš„\n    for ticker in ctx.tickers:\n        current_weight = weights.get(ticker, 0)\n        \n        # è®¡ç®—å‡çº¿\n        short_ma = ctx.ma(ticker, short_period)\n        long_ma = ctx.ma(ticker, long_period)\n        \n        if len(short_ma) < 2 or len(long_ma) < 2:\n            continue\n        \n        # é‡‘å‰: å¢åŠ ä»“ä½\n        if ctx.ma_cross_up(ticker, short_period, long_period):\n            weights[ticker] = min(current_weight + 10, 50)\n            ctx.log(f\"ğŸŸ¢ {ticker} é‡‘å‰ä¿¡å·, å¢åŠ ä»“ä½\")\n        \n        # æ­»å‰: å‡å°‘ä»“ä½\n        elif ctx.ma_cross_down(ticker, short_period, long_period):\n            weights[ticker] = max(current_weight - 10, 0)\n            ctx.log(f\"ğŸ”´ {ticker} æ­»å‰ä¿¡å·, å‡å°‘ä»“ä½\")\n    \n    # è®¾ç½®ç›®æ ‡æƒé‡\n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "Current",
        "created_at": "2026-02-06T17:16:18.466521",
        "updated_at": "2026-02-06T17:16:18.466525"
    },
    "test2": {
        "name": "test2",
        "code": "\"\"\"\né•¿æœŸå¢å¼ºåŠ¨é‡ç­–ç•¥ (Enhanced Momentum Strategy)\nç»“åˆä¸­é•¿æœŸåŠ¨é‡ä¸å¤§ç›˜è¶‹åŠ¿è¿‡æ»¤ï¼Œåœ¨åŸºç¡€ä»“ä½ä¸ŠåšåŠ¨æ€å¢å¼ºã€‚\n\"\"\"\n\ndef strategy():\n    weights = ctx.get_current_weights()\n    \n    # ======================\n    # ç­–ç•¥å‚æ•°\n    # ======================\n    lookback_short = 60      # ä¸­æœŸåŠ¨é‡å‘¨æœŸ\n    lookback_long = 120      # é•¿æœŸåŠ¨é‡å‘¨æœŸ\n    market_ma = 200          # å¤§ç›˜å‡çº¿å‘¨æœŸ\n    adjust_step = 10         # å•æ¬¡è°ƒä»“å¹…åº¦ (%)\n    max_weight = 50          # å•èµ„äº§æœ€å¤§æƒé‡\n    min_weight = 0           # å•èµ„äº§æœ€å°æƒé‡\n    \n    # ======================\n    # å¤§ç›˜è¶‹åŠ¿åˆ¤æ–­ (ä»¥ SPY ä¸ºä¾‹)\n    # ======================\n    # ä¿®æ­£ï¼šä½¿ç”¨ current_price() æ–¹æ³•è·å–å½“å‰ä»·æ ¼\n    market_price = ctx.current_price(\"SPY\")\n    # ä¿®æ­£ï¼šma() è¿”å› Seriesï¼Œéœ€è¦å–æœ€æ–°å€¼\n    market_ma_series = ctx.ma(\"SPY\", market_ma)\n    \n    market_bull = False\n    if market_price and not market_ma_series.empty:\n        market_ma_value = market_ma_series.iloc[-1]\n        market_bull = market_price > market_ma_value\n    \n    # ======================\n    # éå†èµ„äº§\n    # ======================\n    for ticker in ctx.tickers:\n        \n        current_weight = weights.get(ticker, 0)\n        \n        # è®¡ç®—åŒå‘¨æœŸåŠ¨é‡\n        mom_short = ctx.momentum(ticker, lookback_short)\n        mom_long = ctx.momentum(ticker, lookback_long)\n        \n        if mom_short.empty or mom_long.empty:\n            continue\n        \n        current_mom_short = mom_short.iloc[-1]\n        current_mom_long = mom_long.iloc[-1]\n        \n        # ======================\n        # ç‰›å¸‚ + åŒåŠ¨é‡ä¸ºæ­£ â†’ å¢ä»“\n        # ======================\n        if market_bull and current_mom_short > 0 and current_mom_long > 0:\n            \n            weights[ticker] = min(current_weight + adjust_step, max_weight)\n            \n            ctx.log(\n                f\"ğŸ“ˆ {ticker} åŒåŠ¨é‡ä¸ºæ­£ ({current_mom_short:.1f}%, \"\n                f\"{current_mom_long:.1f}%), ç‰›å¸‚å¢å¼º\"\n            )\n        \n        # ======================\n        # ç†Šå¸‚ æˆ– åŒåŠ¨é‡ä¸ºè´Ÿ â†’ å‡ä»“\n        # ======================\n        elif (not market_bull) or (current_mom_short < 0 and current_mom_long < 0):\n            \n            weights[ticker] = max(current_weight - adjust_step, min_weight)\n            \n            ctx.log(\n                f\"ğŸ“‰ {ticker} è¶‹åŠ¿è½¬å¼± ({current_mom_short:.1f}%, \"\n                f\"{current_mom_long:.1f}%), é™ä»“é˜²å®ˆ\"\n            )\n    \n    # ======================\n    # æƒé‡å½’ä¸€åŒ–\n    # ======================\n    total_weight = sum(weights.values())\n    if total_weight > 0:\n        for ticker in weights:\n            weights[ticker] = weights[ticker] / total_weight * 100\n    \n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "op6",
        "created_at": "2026-02-11T16:06:38.154861",
        "updated_at": "2026-02-11T16:06:38.154867"
    },
    "åŒåŠ¨é‡ç­–ç•¥1": {
        "name": "åŒåŠ¨é‡ç­–ç•¥1",
        "code": "\"\"\"\nåŒåŠ¨é‡ç­–ç•¥ (Dual Momentum)\nç»“åˆç»å¯¹åŠ¨é‡ï¼ˆä¸æ— é£é™©æ”¶ç›Šæ¯”è¾ƒï¼‰å’Œç›¸å¯¹åŠ¨é‡ï¼ˆèµ„äº§é—´æ¯”è¾ƒï¼‰ã€‚\nGary Antonacci æå‡ºçš„ç»å…¸ç­–ç•¥ã€‚\n\"\"\"\n\ndef strategy():\n    weights = ctx.get_current_weights()\n    \n    # ç­–ç•¥å‚æ•°\n    lookback = 252  # 12ä¸ªæœˆåŠ¨é‡\n    safe_asset = 'GSD.SI'  # é¿é™©èµ„äº§ï¼ˆå¦‚é»„é‡‘æˆ–å€ºåˆ¸ï¼‰\n    \n    risk_assets = [t for t in ctx.tickers if t != safe_asset]\n    \n    # è®¡ç®—å„èµ„äº§åŠ¨é‡\n    momentums = {}\n    for ticker in risk_assets:\n        mom = ctx.momentum(ticker, lookback)\n        if not mom.empty:\n            momentums[ticker] = mom.iloc[-1]\n    \n    if not momentums:\n        ctx.log(\"âš ï¸ æ— æ³•è®¡ç®—åŠ¨é‡\")\n        return\n    \n    # æ‰¾å‡ºæœ€å¼ºåŠ¨é‡èµ„äº§\n    best_asset = max(momentums, key=momentums.get)\n    best_momentum = momentums[best_asset]\n    \n    ctx.log(f\"ğŸ“Š æœ€å¼ºåŠ¨é‡: {best_asset} ({best_momentum:.1f}%)\")\n    \n    # ç»å¯¹åŠ¨é‡æ£€æŸ¥ï¼šæœ€å¼ºèµ„äº§åŠ¨é‡å¿…é¡»ä¸ºæ­£\n    if best_momentum > 0:\n        # ç›¸å¯¹åŠ¨é‡é€‰æ‹©ï¼šæŠ•èµ„æœ€å¼ºèµ„äº§\n        for ticker in ctx.tickers:\n            weights[ticker] = 100 if ticker == best_asset else 0\n        ctx.log(f\"ğŸš€ ç»å¯¹åŠ¨é‡ä¸ºæ­£ï¼Œå…¨ä»“ {best_asset}\")\n    else:\n        # è´ŸåŠ¨é‡ï¼šè½¬å…¥é¿é™©èµ„äº§\n        for ticker in ctx.tickers:\n            weights[ticker] = 100 if ticker == safe_asset else 0\n        ctx.log(f\"ğŸ›¡ï¸ ç»å¯¹åŠ¨é‡ä¸ºè´Ÿï¼Œè½¬å…¥é¿é™©èµ„äº§ {safe_asset}\")\n    \n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "op6",
        "created_at": "2026-02-12T09:59:05.648999",
        "updated_at": "2026-02-12T09:59:05.649015"
    },
    "å¸ƒæ—å¸¦çªç ´ç­–ç•¥1": {
        "name": "å¸ƒæ—å¸¦çªç ´ç­–ç•¥1",
        "code": "\"\"\"\nå¸ƒæ—å¸¦çªç ´ç­–ç•¥ (Bollinger Breakout)\nä»·æ ¼çªç ´ä¸Šè½¨åšå¤šï¼Œè·Œç ´ä¸‹è½¨å‡ä»“ï¼Œä¸­è½¨ä½œä¸ºè¶‹åŠ¿å‚è€ƒã€‚\n\"\"\"\n\ndef strategy():\n    weights = ctx.get_current_weights()\n    \n    # ç­–ç•¥å‚æ•°\n    bb_period = 20\n    bb_std = 2.0\n    \n    for ticker in ctx.tickers:\n        current_weight = weights.get(ticker, 0)\n        price = ctx.current_price(ticker)\n        \n        # è·å–å¸ƒæ—å¸¦\n        bb = ctx.bollinger(ticker, bb_period, bb_std)\n        if bb.empty:\n            continue\n        \n        upper = bb['upper'].iloc[-1]\n        middle = bb['middle'].iloc[-1]\n        lower = bb['lower'].iloc[-1]\n        \n        # è®¡ç®— %B æŒ‡æ ‡ (ä»·æ ¼åœ¨å¸ƒæ—å¸¦ä¸­çš„ä½ç½®)\n        pct_b = (price - lower) / (upper - lower) if (upper - lower) > 0 else 0.5\n        \n        if price > upper:\n            # çªç ´ä¸Šè½¨ï¼šå¼ºåŠ¿ä¿¡å·\n            weights[ticker] = min(current_weight + 10, 40)\n            ctx.log(f\"ğŸš€ {ticker} çªç ´å¸ƒæ—ä¸Šè½¨ ({price:.2f} > {upper:.2f})\")\n        \n        elif price < lower:\n            # è·Œç ´ä¸‹è½¨ï¼šå¯èƒ½è¶…å–æˆ–ç»§ç»­ä¸‹è·Œ\n            weights[ticker] = max(current_weight - 10, 5)\n            ctx.log(f\"âš ï¸ {ticker} è·Œç ´å¸ƒæ—ä¸‹è½¨ ({price:.2f} < {lower:.2f})\")\n        \n        elif price > middle:\n            # åœ¨ä¸­è½¨ä¸Šæ–¹ï¼šåå¤š\n            ctx.log(f\"ğŸ“Š {ticker} å¸ƒæ—ä¸­è½¨ä¸Šæ–¹ï¼Œ%B={pct_b:.2f}\")\n        \n        else:\n            # åœ¨ä¸­è½¨ä¸‹æ–¹ï¼šåç©º\n            ctx.log(f\"ğŸ“‰ {ticker} å¸ƒæ—ä¸­è½¨ä¸‹æ–¹ï¼Œ%B={pct_b:.2f}\")\n    \n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "op6",
        "created_at": "2026-02-12T10:17:20.188729",
        "updated_at": "2026-02-12T10:17:20.188734"
    },
    "æ”¶ç›Šç‡æ›²çº¿ç­–ç•¥1": {
        "name": "æ”¶ç›Šç‡æ›²çº¿ç­–ç•¥1",
        "code": "\"\"\"\næ”¶ç›Šç‡æ›²çº¿ç­–ç•¥ (å®è§‚é£é™©ç­–ç•¥)\né€šè¿‡ VIX å’Œå¸‚åœºçŠ¶æ€æ¨¡æ‹Ÿå®è§‚ç¯å¢ƒåˆ¤æ–­ã€‚\né«˜ VIX + è¶‹åŠ¿å‘ä¸‹ = ç±»ä¼¼åˆ©ç‡å€’æŒ‚çš„é£é™©ç¯å¢ƒã€‚\n\"\"\"\n\ndef strategy():\n    weights = ctx.get_current_weights()\n    \n    # è·å– VIX å’Œå¸‚åœºçŠ¶æ€\n    current_vix = ctx.current_vix()\n    vix_series = ctx.vix(20)\n    \n    # VIX è¶‹åŠ¿åˆ¤æ–­\n    vix_ma = vix_series.mean() if not vix_series.empty else 20\n    vix_trending_up = current_vix > vix_ma\n    \n    # é£é™©ç­‰çº§è¯„ä¼°\n    risk_assets = ['IWY', 'LVHI']  # æ ¹æ®ç»„åˆè°ƒæ•´\n    safe_assets = ['GSD.SI', 'MBH.SI']\n    \n    if current_vix > 30 and vix_trending_up:\n        # ç±»ä¼¼è¡°é€€é¢„è­¦ï¼šå¤§å¹…å‡å°‘é£é™©æ•å£\n        ctx.log(f\"ğŸ”´ VIX={current_vix:.1f} ä¸”ä¸Šå‡è¶‹åŠ¿ï¼Œè¡°é€€é¢„è­¦æ¨¡å¼\")\n        for ticker in risk_assets:\n            if ticker in weights:\n                weights[ticker] = weights.get(ticker, 0) * 0.3\n        for ticker in safe_assets:\n            if ticker in weights:\n                weights[ticker] = weights.get(ticker, 0) * 1.5\n    \n    elif current_vix > 20:\n        # é£é™©ç¯å¢ƒï¼šè°¨æ…é…ç½®\n        ctx.log(f\"âš ï¸ VIX={current_vix:.1f}ï¼Œè°¨æ…æ¨¡å¼\")\n        for ticker in risk_assets:\n            if ticker in weights:\n                weights[ticker] = weights.get(ticker, 0) * 0.8\n    \n    else:\n        # æ­£å¸¸/ä½é£é™©ç¯å¢ƒ\n        ctx.log(f\"âœ… VIX={current_vix:.1f}ï¼Œæ­£å¸¸é…ç½®\")\n    \n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "op6",
        "created_at": "2026-02-12T10:19:44.767762",
        "updated_at": "2026-02-12T10:19:44.767774"
    },
    "åŠ¨æ€èµ„äº§é…ç½®ç­–ç•¥1": {
        "name": "åŠ¨æ€èµ„äº§é…ç½®ç­–ç•¥1",
        "code": "\"\"\"\nåŠ¨æ€èµ„äº§é…ç½®ç­–ç•¥ (Tactical Asset Allocation)\nç»¼åˆè¶‹åŠ¿ã€åŠ¨é‡ã€æ³¢åŠ¨ç‡å¤šç»´åº¦ä¿¡å·åŠ¨æ€è°ƒæ•´ã€‚\nä»¥å½“å‰ç»„åˆé…ç½®ä¸ºåŸºç¡€ï¼Œæ ¹æ®å¤šç»´åº¦ä¿¡å·è¿›è¡ŒåŠ¨æ€è°ƒæ•´ã€‚\n\"\"\"\n\ndef strategy():\n    # ä½¿ç”¨å½“å‰ç»„åˆé…ç½®ä½œä¸ºåŸºç¡€é…ç½®\n    base_allocation = ctx.get_current_weights()\n    \n    # å¦‚æœå½“å‰ç»„åˆä¸ºç©ºï¼Œä½¿ç”¨ç­‰æƒé‡\n    if not base_allocation or sum(base_allocation.values()) == 0:\n        n = len(ctx.tickers)\n        base_allocation = {t: 100/n for t in ctx.tickers}\n        ctx.log(\"ğŸ“‹ å½“å‰ç»„åˆä¸ºç©ºï¼Œä½¿ç”¨ç­‰æƒé‡ä½œä¸ºåŸºç¡€é…ç½®\")\n    else:\n        ctx.log(\"ğŸ“‹ ä½¿ç”¨å½“å‰ç»„åˆé…ç½®ä½œä¸ºåŸºç¡€\")\n    \n    weights = base_allocation.copy()\n    \n    # è·å–å¸‚åœºç¯å¢ƒ\n    vix = ctx.current_vix()\n    \n    # ä¿¡å·è¯„åˆ†ç³»ç»Ÿ\n    for ticker in ctx.tickers:\n        score = 0\n        \n        # 1. è¶‹åŠ¿ä¿¡å· (+/-1)\n        if ctx.price_above_ma(ticker, 200):\n            score = score + 1\n            ctx.log(f\"ğŸ“ˆ {ticker}: è¶‹åŠ¿å‘ä¸Š +1\")\n        else:\n            score = score - 1\n            ctx.log(f\"ğŸ“‰ {ticker}: è¶‹åŠ¿å‘ä¸‹ -1\")\n        \n        # 2. åŠ¨é‡ä¿¡å· (+/-1)\n        mom = ctx.momentum(ticker, 20)\n        if not mom.empty:\n            if mom.iloc[-1] > 0:\n                score = score + 1\n            else:\n                score = score - 1\n        \n        # 3. RSI ä¿¡å· (+/-1)\n        rsi = ctx.rsi(ticker)\n        if not rsi.empty:\n            current_rsi = rsi.iloc[-1]\n            if 40 < current_rsi < 60:\n                pass  # ä¸­æ€§\n            elif current_rsi < 30:\n                score = score + 1  # è¶…å–åå¼¹æœºä¼š\n            elif current_rsi > 70:\n                score = score - 1  # è¶…ä¹°é£é™©\n        \n        # æ ¹æ®è¯„åˆ†è°ƒæ•´æƒé‡\n        base = weights.get(ticker, 0)\n        adjustment = 1 + (score * 0.15)  # æ¯åˆ†Â±15%\n        weights[ticker] = max(0, base * adjustment)\n        \n        ctx.log(f\"ğŸ“Š {ticker}: åŸºç¡€={base:.1f}%, è¯„åˆ†={score}, è°ƒæ•´å={weights[ticker]:.1f}%\")\n    \n    # VIX æ•´ä½“è°ƒæ•´\n    if vix > 30:\n        ctx.log(f\"âš ï¸ VIX={vix:.1f}ï¼Œæ•´ä½“é™ä½é£é™©æ•å£\")\n        weights = {k: v * 0.7 for k, v in weights.items()}\n    \n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "op6",
        "created_at": "2026-02-12T10:32:30.102214",
        "updated_at": "2026-02-12T10:32:30.102219"
    },
    "å¤šå› å­è¯„åˆ†ç­–ç•¥1": {
        "name": "å¤šå› å­è¯„åˆ†ç­–ç•¥1",
        "code": "\"\"\"\nå¤šå› å­è¯„åˆ†ç­–ç•¥ (Multi-Factor Scoring)\nç»¼åˆåŠ¨é‡ã€æ³¢åŠ¨ç‡ã€è¶‹åŠ¿å¤šä¸ªå› å­æ‰“åˆ†æ’åºã€‚\n\"\"\"\n\ndef strategy():\n    scores = {}\n    \n    for ticker in ctx.tickers:\n        score = 0\n        \n        # å› å­1: åŠ¨é‡ (20æ—¥)\n        mom = ctx.momentum(ticker, 20)\n        if not mom.empty:\n            mom_score = mom.iloc[-1]\n            score = score + mom_score * 2  # æƒé‡2\n        \n        # å› å­2: è¶‹åŠ¿ (åœ¨200æ—¥å‡çº¿ä¸Šæ–¹)\n        if ctx.price_above_ma(ticker, 200):\n            score = score + 10\n        \n        # å› å­3: æ³¢åŠ¨ç‡ (ä½æ³¢åŠ¨åŠ åˆ†)\n        vol = ctx.volatility(ticker, 20, annualize=True)\n        if not vol.empty:\n            vol_val = vol.iloc[-1]\n            if vol_val < 0.15:\n                score = score + 5  # ä½æ³¢åŠ¨\n            elif vol_val > 0.30:\n                score = score - 5  # é«˜æ³¢åŠ¨\n        \n        # å› å­4: RSI (é¿å…æç«¯)\n        rsi = ctx.rsi(ticker)\n        if not rsi.empty:\n            rsi_val = rsi.iloc[-1]\n            if 40 < rsi_val < 60:\n                score = score + 3  # å¥åº·åŒºé—´\n        \n        scores[ticker] = score\n        ctx.log(f\"ğŸ“Š {ticker} ç»¼åˆè¯„åˆ†: {score:.1f}\")\n    \n    # æ ¹æ®è¯„åˆ†åˆ†é…æƒé‡\n    total_score = sum(max(s, 0) for s in scores.values())\n    weights = {}\n    \n    if total_score > 0:\n        for ticker, score in scores.items():\n            if score > 0:\n                weights[ticker] = (score / total_score) * 100\n            else:\n                weights[ticker] = 0\n    else:\n        # å…¨éƒ¨è´Ÿåˆ†ï¼Œç­‰æƒåˆ†é…é¿é™©\n        n = len(ctx.tickers)\n        weights = {t: 100/n for t in ctx.tickers}\n        ctx.log(\"âš ï¸ æ‰€æœ‰èµ„äº§è¯„åˆ†ä¸ºè´Ÿï¼Œç­‰æƒé…ç½®\")\n    \n    ctx.set_target_weights(weights)\n",
        "description": "",
        "portfolio_name": "op6",
        "created_at": "2026-02-12T10:33:36.147285",
        "updated_at": "2026-02-12T10:33:36.147293"
    },
    "åŠ¨é‡ç­–ç•¥2": {
        "name": "åŠ¨é‡ç­–ç•¥2",
        "code": "\"\"\"\nåŠ¨é‡ç­–ç•¥2 - å‡å°‘å›æ’¤ç‰ˆ (Momentum with Drawdown Control)\nåœ¨åŠ¨é‡ç­–ç•¥1åŸºç¡€ä¸Šå¢åŠ å¤šé‡é£é™©æ§åˆ¶ï¼š\n1. è¶‹åŠ¿è¿‡æ»¤ï¼šåªåœ¨ä¸Šå‡è¶‹åŠ¿ä¸­è¿½æ¶¨\n2. VIXæ³¢åŠ¨ç‡ä¿æŠ¤ï¼šé«˜æ³¢åŠ¨ç¯å¢ƒé™ä½ä»“ä½\n3. å›æ’¤æ§åˆ¶ï¼šè¿‘æœŸå›æ’¤è¿‡å¤§æ—¶å‡ä»“\n4. æ¸è¿›è°ƒä»“ï¼šé¿å…å•æ¬¡å¤§å¹…è°ƒæ•´\n\"\"\"\n\ndef strategy():\n    weights = ctx.get_current_weights()\n    \n    # ======================\n    # ç­–ç•¥å‚æ•°\n    # ======================\n    lookback = 20           # åŠ¨é‡è®¡ç®—å‘¨æœŸ\n    threshold = 5           # åŠ¨é‡é˜ˆå€¼ (%)\n    ma_period = 50          # è¶‹åŠ¿è¿‡æ»¤å‡çº¿\n    vix_caution = 25        # VIX è­¦æˆ’çº¿\n    vix_danger = 35         # VIX å±é™©çº¿\n    max_drawdown = -10      # æœ€å¤§å¯æ¥å—å›æ’¤ (%)\n    adjust_step = 3         # å•æ¬¡è°ƒä»“å¹…åº¦ (æ›´å°æ­¥è¿›)\n    max_weight = 35         # å•èµ„äº§æœ€å¤§æƒé‡ (æ›´åˆ†æ•£)\n    min_weight = 5          # æœ€å°ä¿åº•æƒé‡ (ä¸æ¸…é›¶)\n    \n    # ======================\n    # VIX é£é™©ç¯å¢ƒè¯„ä¼°\n    # ======================\n    current_vix = ctx.current_vix()\n    \n    # æ ¹æ® VIX è®¡ç®—é£é™©è°ƒæ•´ç³»æ•°\n    if current_vix >= vix_danger:\n        risk_multiplier = 0.5\n        ctx.log(f\"ğŸ›¡ï¸ VIX={current_vix:.1f} å±é™©åŒºï¼Œä»“ä½å‡åŠ\")\n    elif current_vix >= vix_caution:\n        risk_multiplier = 0.75\n        ctx.log(f\"âš ï¸ VIX={current_vix:.1f} è­¦æˆ’åŒºï¼Œä»“ä½é™ä½25%\")\n    else:\n        risk_multiplier = 1.0\n        ctx.log(f\"âœ… VIX={current_vix:.1f} æ­£å¸¸\")\n    \n    # ======================\n    # éå†èµ„äº§è¿›è¡ŒåŠ¨é‡åˆ†æ\n    # ======================\n    for ticker in ctx.tickers:\n        current_weight = weights.get(ticker, 0)\n        \n        # 1. è®¡ç®—åŠ¨é‡\n        mom = ctx.momentum(ticker, lookback)\n        if mom.empty:\n            continue\n        current_momentum = mom.iloc[-1]\n        \n        # 2. è¶‹åŠ¿è¿‡æ»¤ï¼šæ£€æŸ¥æ˜¯å¦åœ¨å‡çº¿ä¸Šæ–¹\n        in_uptrend = ctx.price_above_ma(ticker, ma_period)\n        \n        # 3. å›æ’¤æ§åˆ¶ï¼šè®¡ç®—è¿‘æœŸæœ€å¤§å›æ’¤\n        dd = ctx.drawdown(ticker)\n        current_drawdown = dd['drawdown'].iloc[-1] * 100 if not dd.empty else 0\n        \n        # ======================\n        # äº¤æ˜“é€»è¾‘\n        # ======================\n        \n        # æƒ…å†µ1: æ­£å‘åŠ¨é‡ + ä¸Šå‡è¶‹åŠ¿ + å›æ’¤å¯æ§ â†’ å¢ä»“\n        if current_momentum > threshold and in_uptrend and current_drawdown > max_drawdown:\n            target = min(current_weight + adjust_step, max_weight)\n            # åº”ç”¨é£é™©ç³»æ•°\n            target = target * risk_multiplier\n            weights[ticker] = max(target, min_weight)\n            ctx.log(f\"ğŸ“ˆ {ticker} åŠ¨é‡{current_momentum:.1f}% è¶‹åŠ¿å‘ä¸Šï¼Œå¢ä»“è‡³{weights[ticker]:.1f}%\")\n        \n        # æƒ…å†µ2: è´Ÿå‘åŠ¨é‡ æˆ– è¶‹åŠ¿å‘ä¸‹ æˆ– å›æ’¤è¿‡å¤§ â†’ å‡ä»“\n        elif current_momentum < -threshold or not in_uptrend or current_drawdown <= max_drawdown:\n            target = max(current_weight - adjust_step, min_weight)\n            weights[ticker] = target\n            \n            if current_drawdown <= max_drawdown:\n                ctx.log(f\"ğŸ”´ {ticker} å›æ’¤{current_drawdown:.1f}%è¿‡å¤§ï¼Œå‡ä»“è‡³{weights[ticker]:.1f}%\")\n            elif not in_uptrend:\n                ctx.log(f\"ğŸ“‰ {ticker} è·Œç ´å‡çº¿ï¼Œå‡ä»“è‡³{weights[ticker]:.1f}%\")\n            else:\n                ctx.log(f\"ğŸ“‰ {ticker} åŠ¨é‡{current_momentum:.1f}%è½¬å¼±ï¼Œå‡ä»“è‡³{weights[ticker]:.1f}%\")\n        \n        # æƒ…å†µ3: åŠ¨é‡å¹³ç¨³ â†’ ç»´æŒä»“ä½ä½†åº”ç”¨é£é™©ç³»æ•°\n        else:\n            weights[ticker] = max(current_weight * risk_multiplier, min_weight)\n            ctx.log(f\"â¡ï¸ {ticker} åŠ¨é‡{current_momentum:.1f}%å¹³ç¨³ï¼Œç»´æŒ{weights[ticker]:.1f}%\")\n    \n    ctx.set_target_weights(weights)\n",
        "description": "å‡å°‘å›æ’¤",
        "portfolio_name": "Current",
        "created_at": "2026-02-12T11:00:00.000000",
        "updated_at": "2026-02-12T11:00:00.000000"
    }
}